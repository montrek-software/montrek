{% extends 'base.html' %}
{% block content %}

<div class="container-fluid">

  <!-- TITLE -->
  <div class="row mb-3">
    <div class="col-12">
      <h2 id="id_montrek_table_title">{{ title }}</h2>
    </div>
  </div>

  <!-- FILTERS + EXPORTS -->
  <div class="row mb-3">

    <!-- LEFT: FILTER FORM -->
    <div class="col-10 tile">
      {% include "partials/table_filter_form.html" %}
    </div>

    <!-- RIGHT: EXPORT BUTTONS -->
    <div class="col-2 text-end">

      <div class="btn-group">

        <!-- CSV -->
        <form action="" method="get" class="d-inline-block">
          <input type="hidden" name="gen_csv" value="true" />
          <button type="submit" class="btn btn-light-custom" title="Export to CSV">
            <i class="bi bi-download"></i>
          </button>
        </form>

        <!-- Excel -->
        <form action="" method="get" class="d-inline-block">
          <input type="hidden" name="gen_excel" value="true" />
          <button type="submit" class="btn btn-light-custom" title="Export to Excel">
            <i class="bi bi-file-earmark-excel"></i>
          </button>
        </form>

        <!-- PDF -->
        <form action="" method="get" class="d-inline-block">
          <input type="hidden" name="gen_pdf" value="true" />
          <button type="submit" class="btn btn-light-custom" title="Export to PDF">
            <i class="bi bi-file-earmark-pdf"></i>
          </button>
        </form>

        <!-- REST -->
        <form action="" method="get" class="d-inline-block">
          <input type="hidden" name="gen_rest_api" value="true" />
          <button type="submit" class="btn btn-light-custom" title="Get REST API data">
            <i class="bi bi-globe"></i>
          </button>
        </form>

        <!-- Refresh -->
        <form action="" method="get" class="d-inline-block">
          <input type="hidden" name="refresh_data" value="true" />
          <button type="submit" class="btn btn-light-custom" title="Refresh data">
            <i class="bi bi-arrow-repeat"></i>
          </button>
        </form>

      </div>

    </div>
  </div>

  <!-- DATA TABLE -->
  <div class="row mb-3">
    <div class="col-12">
      {{ table|safe }}
    </div>
  </div>

  <!-- PAGINATION -->
  <div class="row align-items-center">

    <!-- LEFT SIDE: Pagination nav -->
    <div class="col-lg-10">

      {% if paginator.show_paginator %}
      <nav aria-label="Pagination">
        <ul class="pagination mb-0">

          {% if paginator.has_previous %}
            <!-- FIRST PAGE -->
            <li class="page-item">
              <a class="page-link custom" href="?page=1" title="First Page">
                <i class="bi bi-skip-backward-fill"></i>
              </a>
            </li>

            <!-- PREVIOUS -->
            <li class="page-item">
              <a class="page-link custom" href="?page={{ paginator.previous_page_number }}" title="Previous Page">
                <i class="bi bi-arrow-left-square-fill"></i>
              </a>
            </li>
          {% endif %}

          <!-- CURRENT -->
          <li class="page-item disabled">
            <span class="page-link custom">
              Page {{ paginator.number }}
              {% if not is_large %} / {{ paginator.num_pages }}{% endif %}
            </span>
          </li>

          {% if paginator.has_next %}
            <!-- NEXT -->
            <li class="page-item">
              <a class="page-link custom" href="?page={{ paginator.next_page_number }}" title="Next Page">
                <i class="bi bi-arrow-right-square-fill"></i>
              </a>
            </li>

            {% if not is_large %}
              <!-- LAST -->
              <li class="page-item">
                <a class="page-link custom" href="?page={{ paginator.num_pages }}" title="Last Page">
                  <i class="bi bi-skip-forward-fill"></i>
                </a>
              </li>
            {% endif %}
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    </div>

    <!-- RIGHT SIDE: Format + Pagination Controls -->
    <div class="col-lg-2">

      <div class="d-flex justify-content-end align-items-center gap-3 flex-wrap">

        <!-- FORMAT TOGGLE -->
        <form method="get">
          <input type="hidden" name="action" id="form-is_compact_format-action">
          <button type="submit"
                  onclick="document.getElementById('form-is_compact_format-action').value='{% if is_compact_format %}is_compact_format_false{% else %}is_compact_format_true{% endif %}'"
                  class="btn btn-light-custom btn-sm"
                  title="{% if is_compact_format %}Switch to Large Table format{% else %}Switch to Small Table format{% endif %}">
            <i class="bi {% if is_compact_format %}bi-arrows-angle-expand{% else %}bi-arrows-angle-contract{% endif %}"></i>
          </button>
        </form>

        <!-- ITEMS PER PAGE DISPLAY -->
        <div class="btn btn-light-custom btn-sm disabled">
          {{ paginate_by }}/Page
        </div>

        <!-- PAGINATE + / - -->
        <form class="d-flex align-items-center gap-2">
          <input type="hidden" name="action" id="form-paginate_by-action">

          <button type="submit"
                  onclick="document.getElementById('form-paginate_by-action').value='add_paginate_by'"
                  class="btn btn-light-custom btn-sm"
                  title="Increase number per page">
            <i class="bi bi-plus-circle-fill"></i>
          </button>

          <button type="submit"
                  onclick="document.getElementById('form-paginate_by-action').value='sub_paginate_by'"
                  class="btn btn-light-custom btn-sm"
                  title="Decrease number per page">
            <i class="bi bi-dash-circle-fill"></i>
          </button>

        </form>

      </div>

    </div>

  </div>

</div>

{% endblock %}
